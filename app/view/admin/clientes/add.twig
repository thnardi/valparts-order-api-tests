{% extends "admin/layout.twig" %}
{% block html_title %}Clientes{{ parent() }}{% endblock %}
{% set nav_active = 'clientes' %}
{% set subnav_active = 'clientes' %}
{% block breadcrumbs %}
  <ol class="breadcrumb" style="">
    <li><a href="{{ base_url() }}/admin">Início</a></li>
    <li><a href="{{ base_url() }}/admin/clientes">Clientes</a></li>
    <li class="active">Adicionar</li>
  </ol>
{% endblock %}
{% block content %}

<div class="card">
  <div class="card-header" data-background-color="blue">
    <h3>Cadastrar um Cliente</h3>
  </div>

  <div class="card-content">
    <div class="row">
      <div class="col-xs-12 col-sm-10">
        <form id="userform" role="form" action="{{ base_url() }}/admin/clientes/add" method="POST">
          <div class="row">
            <div class="col-xs-12 col-sm-6">
              <div class="form-group">
                <label for="inputName">Nome</label>
                <input type="text" class="form-control" id="inputName" name="name"  required>
              </div>
            </div>
            <div class="col-xs-12 col-sm-6">
              <div class="form-group">
                <label for="inputEmail">Email</label>
                <input type="email" class="form-control" id="inputEmail" name="email"  required>
              </div>
            </div>
          </div>
          <div class="row">
          <div class="col-xs-12 col-sm-4">
            <div class="form-group">
              <label for="inputTelefone">Telefone</label>
              <input type="text" class="form-control" id="inputTelefone" name="tel_numero"  required>
            </div>
          </div>
            <div class="col-xs-12 col-sm-4">
            <div class="form-group">
              <label for="inputNascimento">Data de Nascimento</label>
              <input type="date" class="form-control" id="inputNascimento" name="nascimento">
            </div>
          </div>
          <div class="col-xs-12 col-sm-4">
            <div class="form-group">
              <label for="inputCPF">CPF</label>
              <input type="text" class="form-control" id="inputCPF" name="cpf"  required>
            </div>
          </div>
          </div>
          <div class="row">
            <div class="col-xs-12 col-sm-6">
              <div class="form-group">
                <label for="inputLogin">Login</label>
                <input type="text" class="form-control" id="inputLogin" name="slug" onkeyup="return AlteraMinusculas(this);" required>
                <div id="inputLogin-feedback"></div>

              </div>
            </div>
            <div class="col-xs-12 col-sm-6">
              <div class="form-group">
                <label for="inputPassword">Senha</label>
                <input type="password" class="form-control" id="inputPassword" name="password" required>
              </div>
            </div>
          </div>

          <div class="row">

            <div class="col-xs-12 col-sm-6">

                <label for="active">Situação do Usuário</label>
                <select class="form-control" id="active" name="active">
                  <option value= "1">Ativo</option>
                  <option value= "0">Inativo</option>
                </select>

            </div>
          </div>
          <div class="form-group">
            <button type="submit" class="btn btn-success">Cadastrar</button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>

{% endblock %}
{% block javascripts %}
<script type="text/javascript">

</script>

<script type="text/javascript">
  function AlteraMinusculas(campo) {
  campo.value=campo.value.toLowerCase();
}
</script>

{#<script>
  $('#inputLogin').on('blur', function(){
    $('#inputLogin').removeAttr('ok');
    $('#inputLogin').val($('#inputLogin').val().trim());
    if ($('#inputLogin').val().trim() == '') {
        $('#inputLogin-feedback').html('');
    } else {
      $.ajax({
        method: "POST",
        url: "{{ base_url }}/admin/clientes/add/verify_slug",
        data: { slug: $('#inputLogin').val()},
        beforeSend: function(jqXHR) {
          $('#inputLogin-feedback').html('<p style="position:absolute;">Aguarde.</p>');
          // lógica para verificar caracteres inválidos no link
          var slug = $('#inputLogin').val();
          var slug_filtered = slug.match(/[A-Za-z0-9_-]*/);
          var dif = slug.localeCompare(slug_filtered);
          var n = slug.indexOf("deleted");
          //var str = "Hello world, welcome to the universe.";

          if ((dif) || (n !== -1)){
            jqXHR.abort(event);
            $('#inputLogin-feedback').html('<p style="color:red; position:absolute;">Padrão não permitido.</p>');
            $('#inputLogin').parent('.form-group').addClass('has-error');
          }
        }
      }).done(function(result)
        {
          if (result === true) {
            $('#inputLogin-feedback').html('<p style="color:green; position:absolute;">Disponível para cadastro.</p>');
            $('#inputLogin').attr('ok', 'ok');
          }

          if (result === false) {
            $('#inputLogin-feedback').html('<p style="color:red; position:absolute;">Login já utilizado. Selecione outro.</p>');
            $('#inputLogin').parent('.form-group').addClass('has-error');
          }
        }).fail(function(jqXHR, textStatus, msg){
            console.log(textStatus);
          });
      }
  });
</script>#}

<script>
  // tratamento do botão enter
  $('body').on('keydown', 'input, select, textarea', function(e) {
    var self = $(this)
      , form = self.parents('form:eq(0)')
      , focusable
      , next
      ;
    //console.log(e.currentTarget);
    if (e.keyCode == 13) {
        focusable = form.find('input,a,select,button,textarea').filter(':visible');
        next = focusable.eq(focusable.index(this)+1);
        if (next.length || e.currentTarget.id == "selectRole") {
          if (e.currentTarget.id == "selectRole") {
            form.submit();
          }
          next.focus();

        } else {
            form.submit();
        }
        return false;
    }
  });
</script>

<script type="text/javascript">
  function AlteraMinusculas(campo) {
  campo.value=campo.value.toLowerCase();
}
</script>

<script>
  $('#inputLogin').on('blur', function(){
    $('#inputLogin').removeAttr('ok');
    $('#inputLogin').val($('#inputLogin').val().trim());
    if ($('#inputLogin').val().trim() == '') {
        $('#inputLogin-feedback').html('');
    } else {
      $.ajax({
        method: "POST",
        url: "{{ base_url }}/admin/clientes/add/verify_slug",
        data: { slug: $('#inputLogin').val()},
        beforeSend: function(jqXHR) {
          $('#inputLogin-feedback').html('<p style="position:absolute;">Aguarde.</p>');
          // lógica para verificar caracteres inválidos no link
          var slug = $('#inputLogin').val();
          var slug_filtered = slug.match(/[A-Za-z0-9_-]*/);
          var dif = slug.localeCompare(slug_filtered);
          var n = slug.indexOf("deleted");
          //var str = "Hello world, welcome to the universe.";

          if ((dif) || (n !== -1)){
            jqXHR.abort(event);
            $('#inputLogin-feedback').html('<p style="color:red; position:absolute;">Padrão não permitido.</p>');
            $('#inputLogin').parent('.form-group').addClass('has-error');
          }
        }
      }).done(function(result)
        {
          if (result === true) {
            $('#inputLogin-feedback').html('<p style="color:green; position:absolute;">Disponível para cadastro.</p>');
            $('#inputLogin').attr('ok', 'ok');
          }

          if (result === false) {
            $('#inputLogin-feedback').html('<p style="color:red; position:absolute;">Login já utilizado. Selecione outro.</p>');
            $('#inputLogin').parent('.form-group').addClass('has-error');
          }
        }).fail(function(jqXHR, textStatus, msg){
            console.log(textStatus);
          });
      }
  });
</script>


<script>
  // tratamento do botão enter
  $('body').on('keydown', 'input, select, textarea', function(e) {
    var self = $(this)
      , form = self.parents('form:eq(0)')
      , focusable
      , next
      ;
    //console.log(e.currentTarget);
    if (e.keyCode == 13) {
        focusable = form.find('input,a,select,button,textarea').filter(':visible');
        next = focusable.eq(focusable.index(this)+1);
        if (next.length || e.currentTarget.id == "selectRole") {
          if (e.currentTarget.id == "selectRole") {
            form.submit();
          }
          next.focus();

        } else {
            form.submit();
        }
        return false;
    }
  });
</script>

<script type="text/javascript">
  $('#userform').submit(function(){
    if ( $('#inputLogin').attr('ok') !== 'ok') {
      $('#inputLogin').focus();
      return false;
    }
    return true;
  });
</script>

{% endblock %}
